- name: Create Unifi group
  group:
    name: "{{ secrets.unifi_controller.group_name }}"
    gid: "{{ secrets.unifi_controller.gid }}"
- name: Create Unifi user
  user:
    name: "{{ secrets.unifi_controller.user_name }}"
    comment: Unifi controller user
    uid: "{{ secrets.unifi_controller.uid }}"
    group: "{{ secrets.unifi_controller.group_name }}"
    update_password: always
    create_home: no
- name: Create Unifi directory
  file:
    path: "{{ chest.services_path }}/unifi"
    state: directory
    owner: "{{ secrets.unifi_controller.user_name }}"
    group: "{{ secrets.unifi_controller.group_name }}"
- name: Start Unifi container
  docker_container:
    name: "{{ unifi_container_name }}"
    image: jacobalberty/unifi:latest
    pull: yes
    restart_policy: always
    purge_networks: yes
    networks:
      - name: "{{ unifi_network }}"
    published_ports:
      - 8080:8080/tcp # Device command/control
      - 3478:3478/udp # STUN protocol
    env:
      TZ: "{{ common.timezone }}"
    volumes:
      - "{{ chest.services_path }}/unifi:/unifi:rw"