location /{{ home_assistant.web_subdir }} {
    rewrite /{{ home_assistant.web_subdir }}/(.*) /$1 break;
    proxy_pass http://{{ home_assistant.container_name }}:{{ home_assistant.ui_port }};
    proxy_set_header Host $host;

    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
}

location /{{ home_assistant.web_subdir }}/api/websocket {
    rewrite /{{ home_assistant.web_subdir }}/(.*) /$1 break;
    proxy_pass http://{{ home_assistant.container_name }}:{{ home_assistant.ui_port }}/api/websocket;
    proxy_set_header Host $host;
    
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
}